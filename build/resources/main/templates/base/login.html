<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <link href="http://fonts.cdnfonts.com/css/roboto" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container-fluid">
    <section class="signin">
        <div class="form-signin">
            <form id="loginForm" action="/login" method="post" modelAttribute="memberDto">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <h1 class="h3 mb-3 fw-normal">Please sign in</h1>
                <div class="form-floating">
                    <label for="floatingInput">Email address</label>
                    <input type="email" name="username" class="form-control" id="floatingInput" placeholder="name@ecplaza.net" title="name@ecplaza.net">
                </div>
                <div class="form-floating">
                    <label for="floatingPassword">Password</label>
                    <input type="password" name="password" class="form-control" id="floatingPassword" placeholder="Password" title="Password">
                </div>
                <span id="error" th:if="${error}">
                <p id="valid" style="color: orange; font-size:12px;"><a th:text="${exception}"></a></p>
              </span>
                <button id="loginBtn" type="button"  class="w-100 btn btn-lg btn-primary">Sign in</button>
            </form>
        </div>
    </section>
</div>


<script>
    // 중복 클릭 방지를 위한 변수
    let isSubmitting = false;
    // 로그인 버튼 클릭 이벤트 핸들러
    function handleLogin() {
        // 중복 클릭일 경우 처리하지 않음
        if (isSubmitting) {
            return;
        }
        if ($('#floatingInput').val()==''){
            var $error = $('#error');
            if ($error.length === 0) {
                // error 요소가 존재하지 않는 경우 요소를 동적으로 생성
                $error = $('<span id="error"></span>');
                var $valid = $('<p id="valid" style="color: red; font-size:12px;"><a>아이디를 입력해 주세요.</a></p>');
                $error.append($valid);
                $('#floatingInput').focus()
            }else {
                $('#valid').children().text('아이디를 입력해 주세요.')
                $('#floatingInput').focus()
            }
            return;
        }
        if ($('#floatingPassword').val()==''){
            var $error = $('#error');
            if ($error.length === 0) {
                // error 요소가 존재하지 않는 경우 요소를 동적으로 생성
                $error = $('<span id="error"></span>');
                var $valid = $('<p id="valid" style="color: red; font-size:12px;"><a>비밀번호를 입력해 주세요.</a></p>');
                $error.append($valid);
                $('#floatingPassword').focus()
            }else {
                $('#valid').children().text('비밀번호를 입력해 주세요.')
                $('#floatingPassword').focus()
            }
            return;
        }
        // 중복 클릭 방지 설정
        isSubmitting = true;
        // 로그인 폼 참조
        const loginForm = document.getElementById("loginForm");
        // 폼 제출
        loginForm.submit();
    }

    // 폼 입력란에서 엔터 키를 눌렀을 때 처리
    function handleKeyPress(event) {
        // 엔터 키를 눌렀을 때 이벤트 처리
        if (event.keyCode === 13) {
            event.preventDefault(); // 폼이 자동으로 서버로 전송되는 것을 방지
            handleLogin(); // 로그인 처리 함수 호출
        }
    }

    // 로그인 버튼 클릭 이벤트 리스너 등록
    const loginBtn = document.getElementById("loginBtn");
    loginBtn.addEventListener("click", handleLogin);
    // 폼 입력란에서 엔터 키 이벤트 리스너 등록
    const floatingInput = document.getElementById("floatingInput");
    const floatingPassword = document.getElementById("floatingPassword");
    floatingInput.addEventListener("keydown", handleKeyPress);
    floatingPassword.addEventListener("keydown", handleKeyPress);
</script>


</body>
</html>
